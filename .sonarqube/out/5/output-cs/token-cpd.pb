ç
]C:\Users\Jhonatan\source\repos\msschool\MSschool.Presentation.Api\Error\CodeErrorException.cs
	namespace 	
MSschool
 
. 
Presentation 
.  
Api  #
.# $
Error$ )
;) *
public 
class 
CodeErrorException 
:  !
CodeErrorResponse" 3
{ 
public 

object 
? 
Details 
{ 
get  
;  !
set" %
;% &
}' (
public 

CodeErrorException 
( 
int 

statusCode 
, 
string 
? 
message 
= 
null 
, 
object		 
?		 
details		 
=		 
null		 
)		 
:		  !
base

 
(

 

statusCode

 
,

 
message

  
)

  !
{ 
Details 
= 
details 
; 
} 
} °
\C:\Users\Jhonatan\source\repos\msschool\MSschool.Presentation.Api\Error\CodeErrorResponse.cs
	namespace 	
MSschool
 
. 
Presentation 
.  
Api  #
.# $
Error$ )
;) *
public 
class 
CodeErrorResponse 
{ 
public 

int 

StatusCode 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
? 
Message 
{ 
get  
;  !
set" %
;% &
}' (
public		 

CodeErrorResponse		 
(		 
int		  

statusCode		! +
,		+ ,
string		- 3
?		3 4
message		5 <
=		= >
null		? C
)		C D
{

 

StatusCode 
= 

statusCode 
;  
Message 
= 
message 
?? '
GetDefaultMessageStatusCode 8
(8 9

statusCode9 C
)C D
;D E
} 
private 
string '
GetDefaultMessageStatusCode .
(. /
int/ 2

statusCode3 =
)= >
{ 
return 

statusCode 
switch  
{ 	
$num 
=> 
$str 5
,5 6
$num 
=> 
$str >
,> ?
$num 
=> 
$str 9
,9 :
$num 
=> 
$str :
,: ;
_ 
=> 
string 
. 
Empty 
} 	
;	 

} 
} Â+
cC:\Users\Jhonatan\source\repos\msschool\MSschool.Presentation.Api\Middleware\ExceptionMiddleware.cs
	namespace 	
MSschool
 
. 
Presentation 
.  
Api  #
.# $

Middleware$ .
;. /
public 
class 
ExceptionMiddleware  
{		 
private

 
readonly

 
RequestDelegate

 $
_next

% *
;

* +
private 
readonly 
ILogger 
< 
ExceptionMiddleware 0
>0 1
_logger2 9
;9 :
private 
readonly 
IHostEnvironment %
_environment& 2
;2 3
public 

ExceptionMiddleware 
( 
RequestDelegate 
next 
, 
ILogger 
< 
ExceptionMiddleware #
># $
logger% +
,+ ,
IHostEnvironment- =
environment> I
)I J
{ 
_next 
= 
next 
; 
_logger 
= 
logger 
; 
_environment 
= 
environment "
;" #
} 
public 

async 
Task 
InvokeAsync !
(! "
HttpContext" -
context. 5
)5 6
{ 
try 
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
catch 
( 
	Exception 
ex 
) 
{ 	
_logger 
. 
LogError 
( 
ex 
,  
ex! #
.# $
Message$ +
)+ ,
;, -
context   
.   
Response   
.   
ContentType   (
=  ) *
$str  + =
;  = >
var!! 

statusCode!! 
=!! 
(!! 
int!! !
)!!! "
HttpStatusCode!!" 0
.!!0 1
InternalServerError!!1 D
;!!D E
var"" 
result"" 
="" 
string"" 
.""  
Empty""  %
;""% &
switch$$ 
($$ 
ex$$ 
)$$ 
{%% 
case&& 

NotFoundEx&& 
_&&  !
:&&! "

statusCode'' 
=''  
(''! "
int''" %
)''% &
HttpStatusCode''& 4
.''4 5
NotFound''5 =
;''= >
break(( 
;(( 
case** 
ValidationEx** !
validationException**" 5
:**5 6

statusCode++ 
=++  
(++! "
int++" %
)++% &
HttpStatusCode++& 4
.++4 5

BadRequest++5 ?
;++? @
result,, 
=,, 
JsonConvert,, (
.,,( )
SerializeObject,,) 8
(,,8 9
new-- 
CodeErrorException-- .
(--. /

statusCode.. &
,..& '
ex// 
.// 
Message// &
,//& '
validationException00 /
.00/ 0
Errors000 6
)006 7
)007 8
;008 9
break11 
;11 
case33 
BadRequestEx33 !
_33" #
:33# $

statusCode44 
=44  
(44! "
int44" %
)44% &
HttpStatusCode44& 4
.444 5

BadRequest445 ?
;44? @
break55 
;55 
case77 
ErrorInternalEx77 $
_77% &
:77& '

statusCode88 
=88  
(88! "
int88" %
)88% &
HttpStatusCode88& 4
.884 5
InternalServerError885 H
;88H I
break99 
;99 
default;; 
:;; 
break<< 
;<< 
}== 
if?? 
(?? 
string?? 
.?? 
IsNullOrEmpty?? $
(??$ %
result??% +
)??+ ,
)??, -
{@@ 
ifAA 
(AA 
_environmentAA  
.AA  !
IsDevelopmentAA! .
(AA. /
)AA/ 0
)AA0 1
{BB 
resultCC 
=CC 
JsonConvertCC (
.CC( )
SerializeObjectCC) 8
(CC8 9
newDD 
CodeErrorExceptionDD .
(DD. /

statusCodeEE &
,EE& '
exFF 
.FF 
MessageFF &
,FF& '
exGG 
.GG 

StackTraceGG )
)GG) *
)GG* +
;GG+ ,
}HH 
elseII 
{JJ 
resultKK 
=KK 
JsonConvertKK (
.KK( )
SerializeObjectKK) 8
(KK8 9
newLL 
CodeErrorExceptionLL .
(LL. /

statusCodeMM &
,MM& '
exNN 
.NN 
MessageNN &
)NN& '
)NN' (
;NN( )
}OO 
}PP 
contextRR 
.RR 
ResponseRR 
.RR 

StatusCodeRR '
=RR( )

statusCodeRR* 4
;RR4 5
awaitSS 
contextSS 
.SS 
ResponseSS "
.SS" #

WriteAsyncSS# -
(SS- .
resultSS. 4
)SS4 5
;SS5 6
}TT 	
}UU 
}XX „ 
LC:\Users\Jhonatan\source\repos\msschool\MSschool.Presentation.Api\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
. -
!AddInfraestructureEntityFramework &
(& '
builder' .
.. /
Configuration/ <
)< =
. 
AddAplication 
( 
) 
; 
builder 
. 
Services 
. "
AddHttpContextAccessor '
(' (
)( )
;) *
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
config %
=>& (
{ 
config 

.
 

SwaggerDoc 
( 
$str 
, 
new 
OpenApiInfo  +
{ 
Title 
= 
$str  
,  !
Description 
= 
$str	 ¢
,
¢ £
Version 
= 
$str 
, 
Contact 
= 
new 
OpenApiContact #
(# $
)$ %
{ 	
Name 
= 
$str 3
,3 4
Email 
= 
$str *
,* +
Url 
= 
new 
Uri 
( 
$str ?
)? @
} 	
} 
) 
; 
} 
) 
; 
builder   
.   
Services   
.   
	AddCarter   
(   
)   
;   
builder"" 
."" 
Services"" 
."" 
AddHealthChecks""  
(""  !
)""! "
.## 
AddSqlServer## 
(## 
builder## 
.$$ 
Configuration$$ 
.%% 
GetConnectionString%% 
(%% 
$str%% +
)%%+ ,
!%%, -
)%%- .
;%%. /
builder'' 
.'' 
Host'' 
.'' 

UseSerilog'' 
('' 
('' 
context''  
,''  !
configuration''" /
)''/ 0
=>''1 3
configuration(( 
.(( 
ReadFrom(( 
.(( 
Configuration(( (
(((( )
context(() 0
.((0 1
Configuration((1 >
)((> ?
)((? @
;((@ A
var** 
app** 
=** 	
builder**
 
.** 
Build** 
(** 
)** 
;** 
if,, 
(,, 
app,, 
.,, 
Environment,, 
.,, 
IsDevelopment,, !
(,,! "
),," #
),,# $
{-- 
app.. 
... 

UseSwagger.. 
(.. 
).. 
;.. 
app// 
.// 
UseSwaggerUI// 
(// 
)// 
;// 
}00 
app22 
.22 $
UseSerilogRequestLogging22 
(22 
)22 
;22 
app44 
.44 
UseMiddleware44 
<44 
ExceptionMiddleware44 %
>44% &
(44& '
)44' (
;44( )
app55 
.55 
	MapCarter55 
(55 
)55 
;55 
app66 
.66 
UseHttpsRedirection66 
(66 
)66 
;66 
app88 
.88 
MapHealthChecks88 
(88 
$str88 
)88 
;88 
app:: 
.:: 
Run:: 
(:: 
):: 	
;::	 
